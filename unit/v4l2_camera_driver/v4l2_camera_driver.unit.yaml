args:
  device:
    type: string
    help: The device to capture from
    default: /dev/video0
  topic_namespace:
    type: string
    default: /camera

threading_model:
  single
cpp_includes:
  - foxglove/RawImage.pb.h
  - image_conversion.h

handlers:
  OnCameraImage:
    sync:
      type: all
      # We can't quite hit 30 fps, probably due to poor coding of this unit
      # Ideally it shouldn't matter and we occasionally drop a frame, but we need controls to not overload the callback buffer and have multiple rate subscriber callbacks in flight
      # This still also really wants type:external as it blocks
      rate: 0.03333333333
      # Run cameras at 10 fps - the current model only runs so fast
      # rate: 0.1
      
      
    outputs:
      "{{args.topic_namespace}}/yuyv":
        type: protobuf:foxglove.RawImage
        inproc_type: image_conversion::CudaManagedImage